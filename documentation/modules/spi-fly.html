<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>SPI Fly :: Apache Aries</title>
    <meta name="generator" content="Antora 2.3.3">
    <link rel="stylesheet" href="../../_/css/site.css">
    <link rel="icon" href="../../_/img/ram.ico" type="image/x-icon">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="../../index.html">
        <span>
          <img src="../../_/img/feather.svg">
        </span>
        <span>
          <img src="../../_/img/ram.svg">
        </span>
        Apache Aries
      </a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="../../index.html">Home</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Projects</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="async-svcs.html">Async Services</a>
            <a class="navbar-item" href="blueprint.html">Blueprint</a>
            <a class="navbar-item" href="jmx.html">JMX</a>
            <a class="navbar-item" href="jndiproject.html">JNDI</a>
            <a class="navbar-item" href="jpaproject.html">JPA</a>
            <a class="navbar-item" href="rsa.html">Remote Service Admin</a>
            <a class="navbar-item" href="spi-fly.html">Spi-Fly</a>
            <a class="navbar-item" href="subsystems.html">Subsystems</a>
            <a class="navbar-item" href="transactioncontrol.html">Transaction Control</a>
          </div>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="../downloads/currentreleases.html">Downloads</a>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="documentation" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">Documentation</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Community</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../community/boardreports.html">Board Reports</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../community/overview.html">Community</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../community/resources.html">Community Resources</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../community/gettinginvolved.html">Getting Involved</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../community/logos.html">Logos</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../community/mailinglists.html">MailingLists</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../community/people.html">People</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Board Reports</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../community/boardreports/april-2011.html">April 2011 Board report</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../community/boardreports/april-2012.html">April 2012 Board report</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../community/boardreports/april-2013.html">April 2013 Board report</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../community/boardreports/april-2014.html">April 2014 Board report</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../community/boardreports/april-2015.html">April 2015 Board report</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../community/boardreports/april-2016.html">April 2016 Board report</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../community/boardreports/april-2018.html">April 2018 Board report</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../community/boardreports/december-2009.html">December 2009 Board Report</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../community/boardreports/december-2010.html">December 2010 Board report</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../community/boardreports/february-2011.html">February 2011 Board report</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../community/boardreports/feb-2015.html">February 2015 Board report</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../community/boardreports/january-2011.html">January 2011 Board report</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../community/boardreports/january-2012.html">January 2012 Board report</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../community/boardreports/january-2013.html">January 2013 Board report</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../community/boardreports/january-2014.html">January 2014 Board report</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../community/boardreports/jan-2016.html">January 2016 Board report</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../community/boardreports/jan-2017.html">January 2017 Board report</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../community/boardreports/jan-2018.html">January 2018 Board report</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../community/boardreports/july-2011.html">July 2011 Board report</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../community/boardreports/july-2012.html">July 2012 Board report</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../community/boardreports/july-2013.html">July 2013 Board report</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../community/boardreports/july-2014.html">July 2014 Board report</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../community/boardreports/july-2015.html">July 2015 Board report</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../community/boardreports/july-2016.html">July 2016 Board report</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../community/boardreports/july-2017.html">July 2017 Board report</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../community/boardreports/july-2018.html">July 2018 Board report</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../community/boardreports/june-2010.html">June 2010 Board Report</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../community/boardreports/march-2010.html">March 2010 Board Report</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../community/boardreports/march-2011.html">March 2011 Board report</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../community/boardreports/may-2017.html">May 2017 Board report</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../community/boardreports/november-2009.html">November 2009 Board Report</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../community/boardreports/nov-2015.html">November 2015 Board report</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../community/boardreports/october-2009.html">October 2009 Board Report</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../community/boardreports/october-2011.html">October 2011 Board report</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../community/boardreports/october-2012.html">October 2012 Board report</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../community/boardreports/oct-2013.html">October 2013 Board report</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../community/boardreports/oct-2014.html">October 2014 Board report</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../community/boardreports/september-2015.html">October 2015 Report from the Apache Aries committee [Jeremy Hughes]</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../community/boardreports/oct-2016.html">October 2016 Board report</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../community/boardreports/oct-2017.html">October 2017 Board report</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../community/boardreports/september-2010.html">September 2010 Board Report</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Development</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../development/versionpolicy.html">Aries versioning policy</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../development/buildingaries.html">BuildingAries</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../development/guidelines.html">Coding guidelines</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../development/compliancetesting.html">ComplianceTesting</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../development/resources.html">Developer Resources</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../development/maintainingthewebpages.html">Maintaining The Web Site</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../development/architecture.html">Module build time dependencies</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../development/ReleaseProcessRequirements.html">Release process requirements</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../development/releasingaries.html">ReleasingAries</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../development/verifyingrelease.html">Verifying Release Artifacts</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Documentation</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../documentation/application-dependencies.html">Aries Application Modules</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../documentation/articles.html">Articles</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../documentation/integrators-guide.html">Integrators guide</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../documentation/tools.html">Tools</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../documentation/tutorials.html">Tutorials</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Tools</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../documentation/tools/repositoryGenerator.html">Repository Generator Tool</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Tutorials</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../documentation/tutorials/blueprinthelloworldtutorial.html">BlueprintHelloWorldTutorial</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../documentation/tutorials/greetertutorial.html">Greeter: Another Blueprint Tutorial</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Downloads</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../downloads/javadoc.html">0.3 Javadocs</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../downloads/currentrelease.html">Apache Aries Downloads</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../downloads/archived-releases.html">Archived releases</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../downloads/currentreleases.html">Downloads</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../downloads/testresults.html">TestResults</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../downloads/ariestrader-1.0.0.html">The AriesTrader Sample</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../downloads/blogsample-1.0.0.html">The Blog Sample</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Archived Releases</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">0.1-incubating</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../downloads/archived-releases/0.1-incubating/0.1-incubating.html">Apache Aries 0.1-incubating release</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../downloads/archived-releases/0.1-incubating/ariestrader-0.1-incubating.html">The AriesTrader Sample</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../downloads/archived-releases/0.1-incubating/blogsample-0.1-incubating.html">The Blog Sample - version 0.1-incubating.</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">0.2-incubating</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../downloads/archived-releases/0.2-incubating/0.2-incubating.html">Apache Aries Downloads</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../downloads/archived-releases/0.2-incubating/0.2-incubating-releasenotes.html">Release Notes</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../downloads/archived-releases/0.2-incubating/0.2-incubating-testresults.html">TestResults</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../downloads/archived-releases/0.2-incubating/ariestrader-0.2-incubating.html">The AriesTrader Sample</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../downloads/archived-releases/0.2-incubating/blogsample-0.2-incubating.html">The Blog Sample</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">0.3-incubating</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../downloads/archived-releases/0.3/0.3.html">Apache Aries Downloads</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../downloads/archived-releases/0.3/0.3-releasenotes.html">Release Notes</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../downloads/archived-releases/0.3/ariestrader-0.3.html">The AriesTrader Sample</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../downloads/archived-releases/0.3/blogsample-0.3.html">The Blog Sample</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">CT</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">0.2-incubating</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../downloads/ct/0.2-incubating/org.osgi.test.cases.blueprint.html">master@documentation:ROOT:downloads/ct/0.2-incubating/org.osgi.test.cases.blueprint.adoc</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../downloads/ct/0.2-incubating/org.osgi.test.cases.blueprint.java5.html">master@documentation:ROOT:downloads/ct/0.2-incubating/org.osgi.test.cases.blueprint.java5.adoc</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../downloads/ct/0.2-incubating/org.osgi.test.cases.blueprint.secure.html">master@documentation:ROOT:downloads/ct/0.2-incubating/org.osgi.test.cases.blueprint.secure.adoc</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../downloads/ct/0.2-incubating/org.osgi.test.cases.jmx.html">master@documentation:ROOT:downloads/ct/0.2-incubating/org.osgi.test.cases.jmx.adoc</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../downloads/ct/0.2-incubating/org.osgi.test.cases.jndi.html">master@documentation:ROOT:downloads/ct/0.2-incubating/org.osgi.test.cases.jndi.adoc</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../downloads/ct/0.2-incubating/org.osgi.test.cases.transaction.html">master@documentation:ROOT:downloads/ct/0.2-incubating/org.osgi.test.cases.transaction.adoc</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../downloads/ct/0.2-incubating/testresults.html">TestResults</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">0.3</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../downloads/ct/0.3/org.osgi.test.cases.blueprint.html">master@documentation:ROOT:downloads/ct/0.3/org.osgi.test.cases.blueprint.adoc</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../downloads/ct/0.3/org.osgi.test.cases.blueprint.java5.html">master@documentation:ROOT:downloads/ct/0.3/org.osgi.test.cases.blueprint.java5.adoc</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../downloads/ct/0.3/org.osgi.test.cases.blueprint.secure.html">master@documentation:ROOT:downloads/ct/0.3/org.osgi.test.cases.blueprint.secure.adoc</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../downloads/ct/0.3/org.osgi.test.cases.jmx.html">master@documentation:ROOT:downloads/ct/0.3/org.osgi.test.cases.jmx.adoc</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../downloads/ct/0.3/org.osgi.test.cases.jndi.html">master@documentation:ROOT:downloads/ct/0.3/org.osgi.test.cases.jndi.adoc</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../downloads/ct/0.3/org.osgi.test.cases.jndi.secure.html">master@documentation:ROOT:downloads/ct/0.3/org.osgi.test.cases.jndi.secure.adoc</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../downloads/ct/0.3/org.osgi.test.cases.transaction.html">master@documentation:ROOT:downloads/ct/0.3/org.osgi.test.cases.transaction.adoc</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../downloads/ct/0.3/testresults.html">TestResults</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">1.0.0</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../downloads/ct/1.0.0/org.osgi.test.cases.blueprint.html">master@documentation:ROOT:downloads/ct/1.0.0/org.osgi.test.cases.blueprint.adoc</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../downloads/ct/1.0.0/org.osgi.test.cases.blueprint.java5.html">master@documentation:ROOT:downloads/ct/1.0.0/org.osgi.test.cases.blueprint.java5.adoc</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../downloads/ct/1.0.0/org.osgi.test.cases.blueprint.secure.html">master@documentation:ROOT:downloads/ct/1.0.0/org.osgi.test.cases.blueprint.secure.adoc</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../downloads/ct/1.0.0/org.osgi.test.cases.jmx.html">master@documentation:ROOT:downloads/ct/1.0.0/org.osgi.test.cases.jmx.adoc</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../downloads/ct/1.0.0/org.osgi.test.cases.jndi.43.html">master@documentation:ROOT:downloads/ct/1.0.0/org.osgi.test.cases.jndi.43.adoc</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../downloads/ct/1.0.0/org.osgi.test.cases.jndi.html">master@documentation:ROOT:downloads/ct/1.0.0/org.osgi.test.cases.jndi.adoc</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../downloads/ct/1.0.0/org.osgi.test.cases.jndi.secure.html">master@documentation:ROOT:downloads/ct/1.0.0/org.osgi.test.cases.jndi.secure.adoc</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../downloads/ct/1.0.0/org.osgi.test.cases.jpa.html">master@documentation:ROOT:downloads/ct/1.0.0/org.osgi.test.cases.jpa.adoc</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../downloads/ct/1.0.0/org.osgi.test.cases.transaction.html">master@documentation:ROOT:downloads/ct/1.0.0/org.osgi.test.cases.transaction.adoc</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">current-release (1.0??)</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../downloads/ct/current-release/org.osgi.test.cases.blueprint.html">master@documentation:ROOT:downloads/ct/current-release/org.osgi.test.cases.blueprint.adoc</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../downloads/ct/current-release/org.osgi.test.cases.blueprint.java5.html">master@documentation:ROOT:downloads/ct/current-release/org.osgi.test.cases.blueprint.java5.adoc</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../downloads/ct/current-release/org.osgi.test.cases.blueprint.secure.html">master@documentation:ROOT:downloads/ct/current-release/org.osgi.test.cases.blueprint.secure.adoc</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../downloads/ct/current-release/org.osgi.test.cases.jmx.html">master@documentation:ROOT:downloads/ct/current-release/org.osgi.test.cases.jmx.adoc</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../downloads/ct/current-release/org.osgi.test.cases.jndi.html">master@documentation:ROOT:downloads/ct/current-release/org.osgi.test.cases.jndi.adoc</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../downloads/ct/current-release/org.osgi.test.cases.transaction.html">master@documentation:ROOT:downloads/ct/current-release/org.osgi.test.cases.transaction.adoc</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Modules</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="applications.html">Aries Applications</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="containers.html">Aries Containers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="jpaproject.html">Aries JPA</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="transactioncontrol.html">Aries Transaction Control Service</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="async-svcs.html">Asynchronous Services</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="blueprint.html">Blueprint</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="blueprintnoosgi.html">Blueprint No-OSGi</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="blueprint-maven-plugin.html">blueprint-maven-plugin</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="blueprintannotation.html">BlueprintAnnotation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="blueprintweb.html">BlueprintWeb</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="ebamavenpluginproject.html">EBA Maven Plugin</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="esaanttask.html">ESA Ant Task</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="esamavenpluginproject.html">ESA Maven Plugin</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="jmx.html">JMX</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="jndiproject.html">JNDI</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="subsystems.html">OSGi Subsystems</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="rsa.html">RSA (Remote Service Admin)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="samples.html">Samples</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="spi-fly.html">SPI Fly</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="transactionsproject.html">Transactions Project</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Samples</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="samples/goatsample.html">GOAT Sample</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="samples/ariestrader.html">The AriesTrader Sample</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="samples/blog-sample.html">The Blog Sample</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Transaction Control</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="tx-control/advancedScopes.html">Advanced Scope control</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="tx-control/localTransactions.html">Aries Local Transaction Control implementation</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="tx-control/localJDBC.html">Aries OSGi Transaction Control JDBC Provider (Local)</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="tx-control/xaJDBC.html">Aries OSGi Transaction Control JDBC Provider (XA)</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="tx-control/localJPA.html">Aries Transaction Control JPA Provider (Local)</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="tx-control/xaJPA.html">Aries Transaction Control JPA Provider (XA)</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="tx-control/xaTransactions.html">Aries XA Transaction Control implementation</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="tx-control/exceptionManagement.html">Exception Management</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="tx-control/quickstart.html">Getting started with the Transaction Control Service</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="tx-control/advancedResourceProviders.html">Making your own Resource Provider</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="tx-control/spring-tx.html">Migrating from declarative transactions</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="tx-control/index.html">The Transaction Control service</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="tx-control/coordinator.html">Using the Coordinator to optimise Transactions</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="tx-control/lastResourceGambit.html">Using the Last Resource Gambit</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Documentation</span>
    <span class="version">master</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">Documentation</span>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">master</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Documentation</a></li>
    <li>Modules</li>
    <li><a href="spi-fly.html">SPI Fly</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/apache/aries-antora-site/edit/master/modules/ROOT/pages/modules/spi-fly.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<article class="doc">
<h1 class="page">SPI Fly</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p><span class="image"><a class="image" href="https://github.com/apache/aries/actions/workflows/spi-fly.yml"><img src="https://github.com/apache/aries/actions/workflows/spi-fly.yml/badge.svg" alt="SPI Fly - CI Build"></a></span>
<span class="image"><a class="image" href="https://search.maven.org/search?q=g:org.apache.aries.spifly"><img src="https://img.shields.io/maven-central/v/org.apache.aries.spifly/spifly?label=Maven%20Central" alt="Maven Central"></a></span></p>
</div>
<div class="paragraph">
<p>This page describes the SPI Fly component.
The SPI Fly component is aimed at providing OSGi support for JRE SPI mechanisms, including the usage of <code>java.util.ServiceLoader</code>,  <code>META-INF/services</code> and similar methods.</p>
</div>
<div class="paragraph">
<p>SPI Fly is the Reference Implementation of the OSGi ServiceLoader Mediator specification, chapter 133 in the <a href="https://docs.osgi.org/specification/osgi.enterprise/7.0.0/service.loader.html">OSGi  Enterprise Specification</a>, available from version 5.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_the_problem"><a class="anchor" href="#_the_problem"></a>The Problem</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Java&#8217;s <code>java.util.ServiceLoader.load()</code>, other similar methods such as  <code>sun.misc.Service.providers()</code> and also other static finder methods such as the  <code>FactoryFinder.find()</code> methods try to locate 'service' implementations by looking for  resources in the <code>META-INF/services</code> directory of all the jars visible to the  <strong><em>Thread Context ClassLoader</em></strong> (TCCL).</p>
</div>
<div class="paragraph">
<p>There are a number of issues with the above mechanisms when used in OSGi:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The Thread Context ClassLoader is not defined in general in an OSGi context.
It can and has to be set by the caller and OSGi cannot generally enforce that.</p>
</li>
<li>
<p>A bundle can&#8217;t <code>Import-Package</code> <code>META-INF/services</code> as potentially many bundles will contain this pseudo-package and the OSGi framework will only bind a single exporter to an importer for a given package.</p>
</li>
<li>
<p>Instantiating an SPI provider generally requires access to internal implementation classes, by exporting these classes an implementing bundle would break its encapsulation.</p>
</li>
<li>
<p>Even if an implementation class was exported, importing this class in a consumer bundle would bind it to the specific implementation package provided, which violates the principle of loose coupling.</p>
</li>
<li>
<p>Bundles have a dynamic life-cycle which means that provided services could disappear when a bundle is updated or uninstalled.
The java.util.ServiceLoader API does not provide a mechanism to inform service consumers of such an event.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The SPI Fly project makes it possible to use existing code that uses  <code>ServiceLoader.load()</code> and similar mechanisms under OSGi.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_making_it_work"><a class="anchor" href="#_making_it_work"></a>Making it Work</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In order to make ServiceLoader (and other similar SPI or plugin mechanisms) work under OSGi, calling code can be woven to set the TCCL to the appropriate providers very briefly, only for the duration of the call.
The SPI Fly component does precisely this.</p>
</div>
<div class="paragraph">
<p>SPI Fly supports two modes of operation:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>OSGi Specification compliant configuration.
This is based on OSGi generic requirements and capabilities and  provides portability across implementations of this specification.
However, it only covers <code>java.util.ServiceLoader</code>.
<a href="#specconf">Find it here</a>.</p>
</li>
<li>
<p>If you need to handle cases other than <code>java.util.ServiceLoader</code>, such as the various FactoryFinders,  <code>javax.imageio.spi.ServiceRegistry</code>, <code>javax.sound.sampled.AudioSystem</code> or others that use the TCCL to find an implementation, you can use the <a href="#specificconf">SPI Fly-specific configuration</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Additionally, services found in the <code>META-INF/services</code> location in opted-in bundles will be registered in the OSGi Service  Registry so that OSGi-aware consumers can simply find them there. This is supported in both the spec-compliant as  well as the proprietary configuration modes. Each such service is registered in the OSGi Service Registry with  the <em>serviceloader.mediator</em> service registration property set.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_getting_spi_fly"><a class="anchor" href="#_getting_spi_fly"></a>Getting SPI Fly</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The latest release of the SPI-Fly components <a href="https://search.maven.org/#search%7Cga%7C1%7Cg%3A%22org.apache.aries.spifly%22">can be found on Maven Central</a>.</p>
</div>
<div class="paragraph">
<p>To use SPI Fly you need to decide whether to use the dynamic weaving bundle, dynamic weaving framework extension or static weaving version.
More information about this can be found in the <a href="#usage">usage section</a>.</p>
</div>
<div id="dynamicweavingbundledependencies" class="listingblock">
<div class="title">To use the dynamic weaving bundle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;org.apache.aries.spifly&lt;/groupId&gt;
    &lt;artifactId&gt;org.apache.aries.spifly.dynamic.bundle&lt;/artifactId&gt;
    &lt;version&gt;${spifly.version}&lt;/version&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.ow2.asm&lt;/groupId&gt;
    &lt;artifactId&gt;asm&lt;/artifactId&gt;
    &lt;version&gt;${asm.version}&lt;/version&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.ow2.asm&lt;/groupId&gt;
    &lt;artifactId&gt;asm-commons&lt;/artifactId&gt;
    &lt;version&gt;${asm.version}&lt;/version&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.ow2.asm&lt;/groupId&gt;
    &lt;artifactId&gt;asm-util&lt;/artifactId&gt;
    &lt;version&gt;${asm.version}&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div id="dynamicweavingfedependencies" class="listingblock">
<div class="title">To use the dynamic weaving framework extension</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;org.apache.aries.spifly&lt;/groupId&gt;
    &lt;artifactId&gt;org.apache.aries.spifly.dynamic.framework.extension&lt;/artifactId&gt;
    &lt;version&gt;${spifly.version}&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div id="staticweavingbundledependencies" class="listingblock">
<div class="title">To use the static weaving bundle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;org.apache.aries.spifly&lt;/groupId&gt;
    &lt;artifactId&gt;org.apache.aries.spifly.static.bundle&lt;/artifactId&gt;
    &lt;version&gt;${spifly.version}&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_building_the_code"><a class="anchor" href="#_building_the_code"></a>Building the code</h3>
<div class="paragraph">
<p>The code can be found in <a href="https://github.com/apache/aries/tree/trunk/spi-fly" class="bare">https://github.com/apache/aries/tree/trunk/spi-fly</a>.</p>
</div>
<div class="paragraph">
<p>To build, use Maven 3.x and run <code>mvn install</code></p>
</div>
</div>
<div class="sect2">
<h3 id="specconf"><a class="anchor" href="#specconf"></a>Configuration: OSGi Spec-compliant</h3>
<div class="paragraph">
<p>All the details surrounding this type of configuration are covered in the  <a href="https://docs.osgi.org/specification/osgi.enterprise/7.0.0/service.loader.html">OSGi Enterprise Specification</a>, chapter 133.
This section provides a short overview.</p>
</div>
<div class="sect3">
<h4 id="_providers"><a class="anchor" href="#_providers"></a>Providers</h4>
<div class="paragraph">
<p>SPI provider bundles opt in to being registered by specifying a requirement on the  <code>osgi.serviceloader.registrar</code> extender.
This is done by adding the following Bundle Manifest header.
Without this they will not be considered by SPI Fly:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">Require-Capability: \
  osgi.extender; \
    filter:="(osgi.extender=osgi.serviceloader.registrar)"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Additionally, they need to provide capabilities for all the APIs that are exposed through this mechanism, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">Provide-Capability: \
  osgi.serviceloader; \
    osgi.serviceloader=org.apache.aries.spifly.mysvc.MySPIProvider</code></pre>
</div>
</div>
<div class="paragraph">
<p>While this example omits it, it is advisable to specify <code>uses</code> constraints on the <code>Provide-Capability</code> header, to  ensure consistent class spaces.</p>
</div>
<div class="paragraph">
<p>See the <a href="#examples"><code>spi-fly-example-provider2-bundle</code></a> for an example of a spec-compliant provider.</p>
</div>
</div>
<div class="sect3">
<h4 id="_consumers"><a class="anchor" href="#_consumers"></a>Consumers</h4>
<div class="paragraph">
<p>An SPI consumer (i.e. a bundle using the <code>java.util.ServiceLoader.load()</code> API) needs to specify required capabilities in the <code>Required-Capability</code> header. Two different types of requirements must be specified:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A requirement on the SPI Fly processing mechanism. This is stated as follows:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">  osgi.extender; \
    filter:="(osgi.extender=osgi.serviceloader.processor)"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Without this requirement the bundle will not be considered for processing.</p>
</div>
</li>
<li>
<p>A requirement on the SPI that needs to be provided through this mechanism, for example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">  osgi.serviceloader; \
    filter:="(osgi.serviceloader=org.apache.aries.spifly.mysvc.MySPIProvider)";cardinality:=multiple</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the <code>cardinality</code> directive is specified to allow multiple bundles to provide the requested capability, allowing provided services to come from more than one provider bundle.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>All requirements are combined into a single Require-Capability header:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">Require-Capability: \
  osgi.serviceloader; \
    filter:="(osgi.serviceloader=org.apache.aries.spifly.mysvc.MySPIProvider)"; \
    cardinality:=multiple, \
  osgi.extender; \
    filter:="(osgi.extender=osgi.serviceloader.processor)"</code></pre>
</div>
</div>
<div class="paragraph">
<p>See the <a href="#examples"><code>spi-fly-example-client2-bundle</code></a> for an example of a spec-compliant consumer.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="specificconf"><a class="anchor" href="#specificconf"></a>Configuration: SPI Fly-specific</h3>
<div class="paragraph">
<p>This section describes how to use SPI Fly&#8217;s proprietary configuration mechanism. It provides more features, but doesn&#8217;t provide the portability that spec-compliance configuration gives. If you are only using SPI Fly with <code>java.util.ServiceLoader</code> or you are only using the provided services through the OSGi Service Registry, then consider using the <a href="#specconf">spec-compliant</a> configuration for portability.</p>
</div>
<div class="sect3">
<h4 id="_providers_2"><a class="anchor" href="#_providers_2"></a>Providers</h4>
<div class="paragraph">
<p>First for all, SPI Fly needs to be made aware of any bundles that provide the services. These bundles are made visible through the TCCL for the duration of the <code>ServiceLoader.load()</code> (or similar) call.</p>
</div>
<div class="paragraph">
<p>To mark a bundle as a Provider, set the <strong><code>SPI-Provider</code></strong> manifest header:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>SPI-Provider: *</code> will consider all providers found in the <code>META-INF/services</code> directory and register them.</p>
</li>
<li>
<p><code>SPI-Provider: org.acme.MySvc1, org.acme.MySvc2</code> will only consider <code>MySvc1</code> and <code>MySvc2</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Additionally services found in <code>META-INF/services</code> are registered in the OSGi Service  Registry.</p>
</div>
<div class="paragraph">
<p>The <code>SPI-Provider</code> header can either be set in the providing bundle itself or in a wrapper bundle that holds the original unmodified jar containing the provider internally as a on the <code>Bundle-ClassPath</code>.</p>
</div>
<div class="paragraph">
<p>See the <a href="#examples"><code>spi-fly-example-provider1-bundle</code></a> for an example of a provider using this type of configuration.</p>
</div>
</div>
<div class="sect3">
<h4 id="_consumers_2"><a class="anchor" href="#_consumers_2"></a>Consumers</h4>
<div class="paragraph">
<p>Service consumers also need to opt in to the process.</p>
</div>
<div class="paragraph">
<p>To specify a consumer, add the <code>SPI-Consumer</code> manifest header to the client bundle.
This header will opt-in the bundle to the weaving process where for the duration of the specified call the TCCL will be set to the matching provider bundle(s).</p>
</div>
<div class="paragraph">
<p>Some example SPI-Consumer headers are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>SPI-Consumer: *</code> is a shorthand for <code>java.util.ServiceLoader#load(java.lang.Class)</code> and will automatically weave all <code>ServiceLoader.load(Class)</code> calls.</p>
</li>
<li>
<p><code>SPI-Consumer: java.util.ServiceLoader#load(java.lang.Class[org.apache.aries.mytest.MySPI])</code> Only process calls to <code>ServiceLoader.load(Class)</code> when it is called with  <code>MySPI.class</code> as argument.</p>
</li>
<li>
<p><code>SPI-Consumer: javax.xml.parsers.DocumentBuilderFactory#newInstance()</code> weave clients that call <code>DocumentBuilderFactory.newInstance()</code>.</p>
</li>
<li>
<p><code>SPI-Consumer: org.foo.Foo#someMthd(),org.bar.Bar#myMethod()</code> weave calls to <code>Foo.someMthd()</code> and <code>Bar.myMethod()</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>See the <a href="#examples"><code>spi-fly-example-client1-bundle</code></a> for an example of a consumer using this type of configuration.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_service_properties"><a class="anchor" href="#_service_properties"></a>Service Properties</h3>
<div class="paragraph">
<p>When a provider is published as an OSGi service it will gain some automatic service properties.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Default Service Properties</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Property</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>serviceloader.mediator</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The bundle Id of the SPI bundle (SPI Fly)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.org.apache.aries.spifly.provider.implclass</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The implementation class of the registered service</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.org.apache.aries.spifly.provider.discovery.mode</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The mode which was used to discover the service; <code>SPI_PROVIDER_HEADER</code> <code>AUTO_PROVIDERS_PROPERTY</code> or <code>SERVICELOADER_CAPABILITIES</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Any additional attributes found on the <code>SPI-Provider</code> header, or the capability will be used as service properties allowing great flexibility for identifying registered services.</p>
</div>
<div class="sect3">
<h4 id="_prototype_scope_service"><a class="anchor" href="#_prototype_scope_service"></a>Prototype Scope Service</h4>
<div class="paragraph">
<p>By default services provided are registered using an <code>org.osgi.framework.ServiceFactory</code>. This means that by default services are <code>bundle</code> scoped. However, it is possible to provide <code>prototype</code> scoped services by adding a service property <code>service.scope=prototype</code> which will cause SPI Fly to register the service using a <code>org.osgi.framework.PrototypeServiceFactory</code>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_special_cases"><a class="anchor" href="#_special_cases"></a>Special Cases</h3>
<div class="paragraph">
<p>SPI Fly can be used for most SPI provider/lookup systems that use the TCCL pattern to obtain implementations. However, in some cases <em>special treatment</em> is needed. This special treatment is often needed when the API itself does not match the name of the resources in <code>META-INF/services</code>, <code>java.util.ServiceLoader</code> is such a case, however SPI-Fly has built-in knowledge of ServiceLoader. Known APIs that require special treatment are listed below:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>javax.imageio.spi.ServiceRegistry</code>: This class is very much like <code>java.util.ServiceLoader</code> in that it can load any kind of API implementation. While SPI Fly knows about ServiceLoader and treats it specially, the ServiceRegistry class currently does not have special treatment.
It can still be made to work but this requires the following header in the provider bundle:</p>
<div class="listingblock">
<div class="content">
<pre>SPI-Provider: javax.imageio.spi.ServiceRegistry</pre>
</div>
</div>
<div class="paragraph">
<p>on the client side you can use</p>
</div>
<div class="listingblock">
<div class="content">
<pre>SPI-Consumer: javax.imageio.spi.ServiceRegistry#lookupProviders(java.lang.Class)</pre>
</div>
</div>
<div class="paragraph">
<p>or</p>
</div>
<div class="listingblock">
<div class="content">
<pre>SPI-Consumer: javax.imageio.spi.ServiceRegistry#lookupProviders</pre>
</div>
</div>
</li>
<li>
<p><code>javax.sound.sampled.AudioSystem</code>: This class uses <code>sun.misc.Service</code> under the covers (via <code>com.sun.media.sound.JDK13Services</code>) which is a predecessor to <code>java.util.ServiceLoader</code>.
There is no special treatment for <code>sun.misc.Service</code> in SPI Fly (yet), but the <code>AudioSystem.getAudioInputStream()</code> API can be made to work by explicitly listing it in the provider bundle (the one that contains the relevant <code>META-INF/services</code> resources):</p>
<div class="listingblock">
<div class="content">
<pre>SPI-Provider: javax.sound.sampled.AudioSystem</pre>
</div>
</div>
<div class="paragraph">
<p>on the consumer side you can use</p>
</div>
<div class="listingblock">
<div class="content">
<pre>SPI-Consumer: javax.sound.sampled.AudioSystem#getAudioInputStream</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_usage_there_are_currently_two_ways_to_use_the_spi_fly_component"><a class="anchor" href="#_usage_there_are_currently_two_ways_to_use_the_spi_fly_component"></a>Usage: There are currently two ways to use the SPI Fly component.</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If you have an OSGi 4.3 (or higher) compliant framework that supports WeavingHooks you can use the dynamic weaving approach for which you have 3 options:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>dynamic weaving bundle</p>
</li>
<li>
<p>dynamic weaving framework extension</p>
</li>
<li>
<p>dynamic weaving auto properties</p>
</li>
</ol>
</div>
</li>
<li>
<p>If you have an pre-4.3 OSGi framework or don&#8217;t want to use bytecode weaving at runtime you  can use the static weaving approach.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_dynamic_weaving_bundle"><a class="anchor" href="#_dynamic_weaving_bundle"></a>Dynamic Weaving Bundle</h3>
<div class="paragraph">
<p>Install and start the <a href="#releases"><code>org.apache.aries.spifly.dynamic.bundle</code></a> into the system (see <a href="#dynamicweavingbundledependencies">dependencies</a>).</p>
</div>
<div class="literalblock">
<div class="content">
<pre>g! lb
START LEVEL 1
   ID|State      |Level|Name
    0|Active     |    0|System Bundle
    ...
    5|Active     |    1|ASM all classes
    7|Active     |    1|Apache Aries SPI Fly Dynamic Weaving Bundle</pre>
</div>
</div>
<div class="paragraph">
<p>Note that, as with any OSGi Bundle that uses the OSGi 4.3 WeavingHooks, the weaver bundle (<code>org.apache.aries.spifly.dynamic.bundle</code> in the SPI Fly case) needs to  be active before any bundles that need to be dynamically woven. OSGi Start Levels can provide a mechanism to control this.</p>
</div>
</div>
<div class="sect2">
<h3 id="_dynamic_weaving_framework_extension"><a class="anchor" href="#_dynamic_weaving_framework_extension"></a>Dynamic Weaving Framework Extension</h3>
<div class="paragraph">
<p>Install and start the <a href="#releases"><code>org.apache.aries.spifly.dynamic.framework.extension</code></a> into the system (see <a href="#dynamicweavingfedependencies">dependencies</a>).</p>
</div>
<div class="literalblock">
<div class="content">
<pre>g! lb
START LEVEL 1
   ID|State      |Level|Name
    0|Active     |    0|System Bundle
    ...
    7|Active     |    1|Apache Aries SPI Fly Dynamic Framework Extension</pre>
</div>
</div>
<div class="paragraph">
<p>Note that, the framework extension bundle (<code>org.apache.aries.spifly.dynamic.framework.extension</code> in the SPI Fly case) attaches to and extends the <code>system.bundle</code>. As such it will always be active before any consumer or provider bundles that have a requirement on it (via the <code>osgi.serviceloader.processor</code> or <code>osgi.serviceloader.registrar</code> requirements.)</p>
</div>
</div>
<div class="sect2">
<h3 id="_dynamic_weaving_by_auto_properties"><a class="anchor" href="#_dynamic_weaving_by_auto_properties"></a>Dynamic Weaving by auto properties</h3>
<div class="paragraph">
<p>Install and start either the <code>bundle</code> or <code>framework.extension</code> as described above, then provide the following framework properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>org.apache.aries.spifly.auto.consumers</code> - Provide a comma delimited list of <code>Bundle-SymbolicName</code> globs (ant style) which should be woven as consumers. Only ServiceLoader is supported by this mechanism.</p>
<div class="paragraph">
<p>For example, the following tells SPI Fly that all bundles with <code>Bundle-SymbolicName</code> matching <code>jakarta.*</code> should have their ServiceLoader calls be woven:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">org.apache.aries.spifly.auto.consumers=jakarta.*</code></pre>
</div>
</div>
</li>
<li>
<p><code>org.apache.aries.spifly.auto.providers</code> - Provide a comma delimited list of <code>Bundle-SymbolicName</code> globs (ant style) which should be registered as providers. Any <code>META-INF/services</code> located in matching bundles will have those made available as providers and published as services. Any additional attributes found associated with a given entry will be added as service properties.</p>
<div class="paragraph">
<p>For example, the following tells SPI Fly that all bundles with <code>Bundle-SymbolicName</code> matching <code>com.sun.*</code> should have their services registered as providers. At the same time the service property <code>vendor=Oracle</code> will be added to registred services. Meanwhile a bundle matching <code>my.provider</code> will have its services registered as providers with the service property <code>vendor=Me</code> and as <code>prototype</code> scoped in the service registry:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">org.apache.aries.spifly.auto.providers=" \
    com.sun.*;vendor=Oracle, \
    my.provider;vendor=Me;service.scope=prototype"</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Note:</strong> The syntax for these two properties matches the <a href="https://osgi.github.io/osgi/core/framework.module.html#framework.common.header.syntax">Common Header Syntax</a> defined by the OSGi Core specification.</p>
</div>
</div>
<div class="sect2">
<h3 id="_use_with_static_weaving"><a class="anchor" href="#_use_with_static_weaving"></a>Use with Static Weaving</h3>
<div class="paragraph">
<p>For static use, you need to weave the client bundle before installing it into the system. The modification changes the byte code around <code>java.util.ServiceLoader.load()</code> or other calls in the bundle and inserts calls to set the correct ThreadContextClassLoader around it. Provider bundles are still handled dynamically.</p>
</div>
<div class="sect3">
<h4 id="_to_statically_weave_a_bundle"><a class="anchor" href="#_to_statically_weave_a_bundle"></a>To statically weave a bundle</h4>
<div class="paragraph">
<p>The easiest way to invoke the static weaver is to take the <a href="#releases"><code>org.apache.aries.spifly.static.tool</code></a> jar with dependencies. Then run the static tool on any bundle that needs processing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">java -jar org.apache.aries.spifly.static.tool-1.0.2-jar-with-dependencies.jar mybundle.jar</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will produce a second bundle with the same name with the <code>_spifly</code> suffix appended, so in this case the generated bundle will be called mybundle_spifly.jar.</p>
</div>
<div class="paragraph">
<p>At runtime, install the <a href="#releases"><code>org.apache.aries.spifly.static.bundle</code></a> into the system:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>g! lb
START LEVEL 1
   ID|State      |Level|Name
    0|Active     |    0|System Bundle
    ...
    6|Active     |    1|Apache Aries SPI Fly Static Weaving Bundle</pre>
</div>
</div>
<div class="paragraph">
<p>Then install and start the statically woven bundle into the system.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>spi-fly-examples</code> directory contains a number of example bundles that can be  used for testing or experimenting.</p>
</div>
<div class="paragraph">
<p>The following modules can be found in this directory:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>spi-fly-example-spi-bundle</strong> - a bundle providing an SPI interface used by the other example bundles. <a href="https://github.com/apache/aries/tree/trunk/spi-fly/spi-fly-examples/spi-fly-example-spi-bundle/">source</a></p>
</li>
<li>
<p><strong>spi-fly-example-provider1-jar</strong> - a plain jar file providing an implementation of the SPI (via <code>META-INF/services</code>). <a href="https://github.com/apache/aries/tree/trunk/spi-fly/spi-fly-examples/spi-fly-example-provider1-jar/">source</a></p>
</li>
<li>
<p><strong>spi-fly-example-provider1-bundle</strong> - a bundle that wraps the jar file from the previous bullet and specifies it in its <code>Bundle-ClassPath</code>. This example represents the common case where an existing SPI provider is wrapped as-is in an OSGi bundle. This example uses the SPI Fly proprietary configuration. <a href="https://github.com/apache/aries/tree/trunk/spi-fly/spi-fly-examples/spi-fly-example-provider1-bundle/">source</a></p>
</li>
<li>
<p><strong>spi-fly-example-provider2-bundle</strong> - a bundle that directly provides an SPI service (via <code>META-INF/services</code>). This example uses OSGi  specification compliant configuration. <a href="https://github.com/apache/aries/tree/trunk/spi-fly/spi-fly-examples/spi-fly-example-provider2-bundle/">source</a></p>
</li>
<li>
<p><strong>spi-fly-example-client1-jar</strong> - a plain jar using <code>java.util.ServiceLoader.load()</code> to obtain and invoke all services provided of a certain SPI. <a href="https://github.com/apache/aries/tree/trunk/spi-fly/spi-fly-examples/spi-fly-example-client1-jar/">source</a></p>
</li>
<li>
<p><strong>spi-fly-example-client1-bundle</strong> - a bundle that wraps the jar file from the previous bullet and lists it in its <code>Bundle-ClassPath</code>. This example represents the common case where an existing SPI consumer is wrapped as-is in an OSGi bundle. This example uses SPI Fly proprietary configuration. <a href="https://github.com/apache/aries/tree/trunk/spi-fly/spi-fly-examples/spi-fly-example-client1-bundle/">source</a></p>
</li>
<li>
<p><strong>spi-fly-example-client2-bundle</strong> - a bundle that has code that invokes <code>java.util.ServiceLoader.load()</code> directly. This example uses OSGi specification compliant configuration. <a href="https://github.com/apache/aries/tree/trunk/spi-fly/spi-fly-examples/spi-fly-example-client2-bundle/">source</a></p>
</li>
<li>
<p><strong>spi-fly-example-provider-consumer-bundle</strong> - a bundle that is both a provider and a consumer at the same time. <a href="https://github.com/apache/aries/tree/trunk/spi-fly/spi-fly-examples/spi-fly-example-provider-consumer-bundle/">source</a></p>
</li>
<li>
<p><strong>spi-fly-example-resource-provider-bundle</strong> and <strong>spi-fly-example-resource-client-bundle</strong> - these bundles show that SPI Fly can be used to control the TCCL in OSGi for any situation, in this case applied to resource loading via the TCCL. The provider bundle provides a resource used by the <code>Foo.doit()</code> API. The client bundle contains <code>Foo.doit()</code> and in there calls <code>Thread.getContextClassLoader().getResource()</code> to obtain the resource. The TCCL has visibility of the provider bundle because both bundles have the appropriate values set in the <code>SPI-Provider</code> and <code>SPI-Consumer</code> headers. <a href="https://github.com/apache/aries/tree/trunk/spi-fly/spi-fly-examples/spi-fly-example-resource-provider-bundle/">source</a> and <a href="https://github.com/apache/aries/tree/trunk/spi-fly/spi-fly-examples/spi-fly-example-resource-client-bundle/">source</a>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_more_information"><a class="anchor" href="#_more_information"></a>More Information</h2>
<div class="sectionbody">
<div class="paragraph">
<p>More information can be found at the following resources:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>OSGi Service Loader Mediator specification.
<a href="https://docs.osgi.org/specification/osgi.enterprise/7.0.0/service.loader.html">OSGi Enterprise specification</a>, Chapter 133.</p>
</li>
<li>
<p>OSGi Blog article: <a href="https://blog.osgi.org/2013/02/javautilserviceloader-in-osgi.html">java.util.ServiceLoader in OSGi</a></p>
</li>
</ul>
</div>
</div>
</div>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <p>Content licensed under AL2. UI licensed under MPL-2.0 with extensions licensed under AL2</p>
</footer>
<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
  </body>
</html>
